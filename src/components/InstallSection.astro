---
const tabs = [
  {
    id: "scoop",
    label: "scoop",
    code: "scoop bucket add climp https://github.com/olivier-w/climp\nscoop install climp",
  },
  {
    id: "go",
    label: "go install",
    code: "go install github.com/olivier-w/climp@latest",
  },
  {
    id: "source",
    label: "source",
    code: "git clone https://github.com/olivier-w/climp.git\ncd climp\ngo build -o climp .",
  },
];
---

<div id="install" class="install-tabs" data-tabs>
  {/* Tab buttons */}
  <div class="flex justify-center gap-0 border-b border-[var(--color-border)]">
    {tabs.map((tab, i) => (
      <button
        class:list={[
          "tab-btn px-3 py-1.5 text-xs transition-colors relative",
          i === 0
            ? "text-[var(--color-accent)]"
            : "text-[var(--color-text-faint)] hover:text-[var(--color-text-muted)]",
        ]}
        data-tab={tab.id}
        aria-selected={i === 0 ? "true" : "false"}
        role="tab"
      >
        {tab.label}
        <span
          class:list={[
            "absolute bottom-0 left-0 right-0 h-px bg-[var(--color-accent)] transition-opacity",
            i === 0 ? "opacity-100" : "opacity-0",
          ]}
          data-indicator
        />
      </button>
    ))}
  </div>

  {/* Tab panels */}
  {tabs.map((tab, i) => (
    <div
      class:list={["tab-panel", i !== 0 && "hidden"]}
      data-panel={tab.id}
      role="tabpanel"
    >
      <div class="relative bg-[var(--color-bg)] border border-[var(--color-border)] border-t-0 rounded-b-lg">
        <pre class="px-4 py-3 text-xs text-[var(--color-text-muted)] overflow-x-auto"><code>{tab.code}</code></pre>
        <button
          class="copy-btn absolute top-2 right-2 text-xs text-[var(--color-text-faint)] hover:text-[var(--color-accent)] transition-colors px-2 py-0.5"
          data-code={tab.code}
        >
          copy
        </button>
      </div>
    </div>
  ))}
</div>

<script>
  document.querySelectorAll("[data-tabs]").forEach((container) => {
    const buttons = container.querySelectorAll<HTMLButtonElement>("[data-tab]");
    const panels = container.querySelectorAll<HTMLElement>("[data-panel]");

    buttons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const tabId = btn.dataset.tab!;

        buttons.forEach((b) => {
          const isActive = b.dataset.tab === tabId;
          b.classList.toggle("text-[var(--color-accent)]", isActive);
          b.classList.toggle("text-[var(--color-text-faint)]", !isActive);
          b.setAttribute("aria-selected", String(isActive));
          const indicator = b.querySelector("[data-indicator]") as HTMLElement;
          if (indicator) {
            indicator.classList.toggle("opacity-100", isActive);
            indicator.classList.toggle("opacity-0", !isActive);
          }
        });

        panels.forEach((p) => {
          p.classList.toggle("hidden", p.dataset.panel !== tabId);
        });
      });
    });
  });

  document.querySelectorAll<HTMLButtonElement>(".copy-btn").forEach((btn) => {
    btn.addEventListener("click", async () => {
      const code = btn.dataset.code;
      if (!code) return;
      try {
        await navigator.clipboard.writeText(code);
        const original = btn.textContent;
        btn.textContent = "copied!";
        btn.classList.add("text-[var(--color-accent)]");
        setTimeout(() => {
          btn.textContent = original;
          btn.classList.remove("text-[var(--color-accent)]");
        }, 1500);
      } catch {
        // Clipboard API not available
      }
    });
  });
</script>
