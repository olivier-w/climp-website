---
const tabs = [
  {
    id: "go",
    label: "go install",
    code: "go install github.com/olivier-w/climp@latest",
  },
  {
    id: "scoop",
    label: "scoop",
    code: "scoop bucket add climp https://github.com/olivier-w/scoop-bucket\nscoop install climp",
  },
  {
    id: "source",
    label: "source",
    code: "git clone https://github.com/olivier-w/climp.git\ncd climp\ngo build -o climp .",
  },
];
---

<div id="install" class="install-tabs" data-tabs>
  {/* Tab buttons — segmented pill control */}
  <div class="relative flex bg-surface rounded-lg p-0.5" role="tablist">
    <span
      class="install-pill absolute top-0.5 bottom-0.5 left-0.5 rounded-md bg-surface-hover"
      data-pill
      style={`width: calc(${100 / tabs.length}% - 2px);`}
    />
    {tabs.map((tab, i) => (
      <button
        class:list={[
          "tab-btn relative flex-1 px-3 py-2 text-xs transition-colors z-[1]",
          i === 0
            ? "text-text"
            : "text-text-faint hover:text-text-muted",
        ]}
        data-tab={tab.id}
        data-index={i}
        aria-selected={i === 0 ? "true" : "false"}
        role="tab"
      >
        {tab.label}
      </button>
    ))}
  </div>

  {/* Tab panels — grid overlay so tallest panel sets the height */}
  <div class="grid min-w-0 mt-2">
    {tabs.map((tab, i) => (
      <div
        class:list={[
          "tab-panel col-start-1 row-start-1 transition-opacity duration-150 min-w-0",
          i === 0 ? "opacity-100" : "opacity-0 pointer-events-none",
        ]}
        data-panel={tab.id}
        role="tabpanel"
      >
        <div class="relative bg-bg border border-border rounded-lg overflow-hidden">
          <pre class="px-4 py-3.5 text-xs text-text-muted overflow-x-auto"><code>{tab.code}</code></pre>
          <button
            class="copy-btn absolute top-2 right-2 text-xs text-text-faint hover:text-accent transition-colors px-2.5 py-1 border border-transparent hover:border-border rounded"
            data-code={tab.code}
          >
            copy
          </button>
        </div>
      </div>
    ))}
  </div>
</div>

<script>
  document.querySelectorAll("[data-tabs]").forEach((container) => {
    const buttons = container.querySelectorAll<HTMLButtonElement>("[data-tab]");
    const panels = container.querySelectorAll<HTMLElement>("[data-panel]");
    const pill = container.querySelector<HTMLElement>("[data-pill]");

    buttons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const tabId = btn.dataset.tab!;
        const index = Number(btn.dataset.index);

        // Slide pill to active tab
        if (pill) {
          pill.style.transform = `translateX(${index * 100}%)`;
        }

        buttons.forEach((b) => {
          const isActive = b.dataset.tab === tabId;
          b.classList.toggle("text-text", isActive);
          b.classList.toggle("text-text-faint", !isActive);
          b.classList.toggle("hover:text-text-muted", !isActive);
          b.setAttribute("aria-selected", String(isActive));
        });

        panels.forEach((p) => {
          const isActive = p.dataset.panel === tabId;
          p.classList.toggle("opacity-100", isActive);
          p.classList.toggle("opacity-0", !isActive);
          p.classList.toggle("pointer-events-none", !isActive);
        });
      });
    });
  });

  document.querySelectorAll<HTMLButtonElement>(".copy-btn").forEach((btn) => {
    btn.addEventListener("click", async () => {
      const code = btn.dataset.code;
      if (!code) return;
      try {
        await navigator.clipboard.writeText(code);
        const original = btn.textContent;
        btn.textContent = "copied!";
        btn.classList.add("text-accent");
        setTimeout(() => {
          btn.textContent = original;
          btn.classList.remove("text-accent");
        }, 1500);
      } catch {
        // Clipboard API not available
      }
    });
  });
</script>
